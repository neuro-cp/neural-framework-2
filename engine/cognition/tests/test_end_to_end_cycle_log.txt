=================================== FAILURES ====================================
_______________________ test_full_cognitive_cycle_offline ________________________

    def test_full_cognitive_cycle_offline() -> None:
        brain = _brain_compile(BASE_DIR)
        rt = BrainRuntime(brain, dt=0.01)

        tracker, trace = _attach_episode_observer(rt)

        decision = _run_to_decision(rt, warmup=100, max_steps=1400)
        assert decision.get("winner") is not None, "Decision fired but has no winner"

        episodes = _episodes_from_tracker(tracker)
        assert len(episodes) >= 1, "No episodes captured by EpisodeTracker"

        frames = _replay_episode(episodes, trace)
        assert len(frames) > 0, "EpisodeReplay produced no frames"

        reg = CogHypothesisRegistry()

        h0 = reg.create(hypothesis_id="H0", created_step=0)
        h1 = reg.create(hypothesis_id="H1", created_step=0)

        # TEST-ONLY: allow grounding to sustain, not create, hypotheses
        h0.activation = 0.08
        h1.activation = 0.08


        grounding = HypothesisGrounding(support_gain=1.0, max_support=10.0)
        dynamics = HypothesisDynamics(decay_rate=0.01)
        competition = HypothesisCompetition(competition_gain=0.05)
        stabilizer = HypothesisStabilization(activation_threshold=0.10, sustain_steps=5)
        biaser = HypothesisBias(bias_gain=0.05, max_bias=0.2)

        stabilized_ids: set[str] = set()

        for _, raw in enumerate(frames):
            reg.tick()

            snapshots = _unwrap_replay_frame(raw)

            for snap in snapshots:
                observed = _extract_observed_association_assemblies(snap)
                if not observed:
                    observed = _extract_numeric_association_outputs(snap)

                if not observed:
                    continue  # skip empty snapshots safely

                grounding.step(hypotheses=reg.all(), observed_assemblies=observed)

                for h in reg.all():
                    if not h.active:
                        continue

                    # Incremental activation update (persistence-aware)
                    delta = _support_to_activation(h, max_support=grounding.max_support)
                    h.activation = min(1.0, h.activation + delta)

                dynamics.step(reg.all())
                competition.step(reg.all())

                events = stabilizer.step(reg.all())
                for e in events:
                    if e.get("event") == "hypothesis_stabilized":
                        stabilized_ids.add(str(e.get("hypothesis_id")))

                if stabilized_ids:
                    break  # exit snapshot loop

            if stabilized_ids:
                break  # exit frame loop

>       assert stabilized_ids, "No hypothesis stabilized during replay"
E       AssertionError: No hypothesis stabilized during replay
E       assert set()

engine\cognition\tests\test_full_cognitive_cycle_offline.py:374: AssertionError
------------------------------ Captured stdout call ------------------------------
[DEBUG] Neuron bases loaded: 5
[DEBUG] Loading regions from: C:\Users\Admin\Desktop\neural framework\regions
[DEBUG] BrainMap loaded from brain_map.json
[DEBUG] RegionAliasRegistry loaded from region_aliases.json
[DEBUG] Loaded region: amyg_base | populations=0
[DEBUG] Loaded region: bla | populations=2
[DEBUG] Loaded region: cea | populations=1
[DEBUG] Loaded region: mea | populations=1
[DEBUG] Loaded region: bg_base | populations=0
[DEBUG] Loaded region: gpe | populations=1
[DEBUG] Loaded region: gpi | populations=1
[DEBUG] Loaded region: snc | populations=1
[DEBUG] Loaded region: stn | populations=1
[DEBUG] Loaded region: striatum | populations=3
[DEBUG] Loaded region: autonomic_system | populations=2
[DEBUG] Loaded region: brainstem_base | populations=0
[DEBUG] Loaded region: locus_coeruleus | populations=1
[DEBUG] Loaded region: medulla | populations=1
[DEBUG] Loaded region: pons | populations=1
[DEBUG] Loaded region: raphe | populations=1
[DEBUG] Loaded region: vta | populations=2
[DEBUG] Loaded region: cerebellar_cortex | populations=3
[DEBUG] Loaded region: cerebellum_base | populations=0
[DEBUG] Loaded region: deep_nuclei | populations=1
[DEBUG] Loaded region: a1 | populations=4
[DEBUG] Loaded region: cortex_base | populations=5
[DEBUG] Loaded region: insula | populations=3
[DEBUG] Loaded region: m1 | populations=3
[DEBUG] Loaded region: s1 | populations=5
[DEBUG] Loaded region: v1 | populations=5
[DEBUG] Loaded region: ca1 | populations=2
[DEBUG] Loaded region: ca3 | populations=2
[DEBUG] Loaded region: dentate_gyrus | populations=2
[DEBUG] Loaded region: hip_base | populations=0
[DEBUG] Loaded region: subiculum | populations=1
[DEBUG] Loaded region: association_cortex | populations=4
[DEBUG] Loaded region: corpus_callosum | populations=1
[DEBUG] Loaded region: Intralaminar | populations=1
[DEBUG] Loaded region: pfc | populations=6
[DEBUG] Loaded region: inferior_colliculus | populations=3
[DEBUG] Loaded region: superior_colliculus | populations=3
[DEBUG] Loaded region: auditory_input | populations=0
[DEBUG] Loaded region: gustatory_input | populations=0
[DEBUG] Loaded region: sensory_base | populations=0
[DEBUG] Loaded region: somato_input | populations=0
[DEBUG] Loaded region: visual_input | populations=0
[DEBUG] Loaded region: endocrine_system | populations=0
[DEBUG] Loaded region: hypothalamus | populations=4
[DEBUG] Loaded region: anterior_pituitary | populations=5
[DEBUG] Loaded region: posterior_pituitary | populations=2
[DEBUG] Loaded region: lgn | populations=1
[DEBUG] Loaded region: md | populations=1
[DEBUG] Loaded region: mgb | populations=1
[DEBUG] Loaded region: pulvinar | populations=1
[DEBUG] Loaded region: thalamus_base | populations=0
[DEBUG] Loaded region: trn | populations=1
[DEBUG] Loaded region: vpl | populations=2
[DEBUG] Loaded region: vpm | populations=1
[DEBUG] Total regions loaded: 54
[DEBUG] Profiles loaded: 12
[DEBUG] Global dynamics loaded from C:\Users\Admin\Desktop\neural framework\config\global_dynamics.json
[DEBUG] Routing defaults loaded from C:\Users\Admin\Desktop\neural framework\config\routing_defaults.json
[DEBUG] Compile complete.
  Regions: 54
  Assembly downscale: 1.0
============================ short test summary info =============================
FAILED engine/cognition/tests/test_full_cognitive_cycle_offline.py::test_full_cognitive_cycle_offline - AssertionError: No hypothesis stabilized during replay
1 failed in 3.16s

C:\Users\Admin\Desktop\neural framework>